{% extends "layout.html" %}

{% block title %}
    {{lang.index.title}} — API
{% endblock %}

{% block head %}
  <script>
    window.ENDPOINTS = {
      ROOT_API: "{{ url_for('api') }}",
      ENDPOINTS: "{{ url_for('endpoints') }}",
      METRICS: "{{ url_for('metricsPage') }}",
      THRESHOLDS: "{{ url_for('thresholdsPage') }}",
      EXAMPLES_ROOT: "{{ url_for('examplesList') }}",
      EXAMPLE_SIMPLE: "{{ url_for('examplesPage', filename='simpleRequest.json') }}",
      EXAMPLE_COMPLETE: "{{ url_for('examplesPage', filename='completeRequest.json') }}",
      DATA_ROOT: "{{ url_for('dataList') }}",
      DATA_K2: "{{ url_for('dataPage', filename='K2.csv') }}",
      DATA_KOI: "{{ url_for('dataPage', filename='KOI.csv') }}",
      DATA_TOI: "{{ url_for('dataPage', filename='TOI.csv') }}",
      CALCULATE: "{{ url_for('calculateDispositionsPage') }}"
    };
  </script>
  <script defer src="{{ url_for('static', filename='js/apiEndpoints.js') }}"></script>
{% endblock %}

{% block main %}
<div class="container">

  <!-- Header -->
  <div class="card mb-4 p-3">
    <h1 class="mb-0">Sidereus API</h1>
    <p class="mb-0">Test the model, inspect metrics, and browse endpoints.</p>
  </div>

  <!-- Tabs (simple) -->
  <nav data-tabs="sidereus" class="d-flex gap-2 p-2 border-bottom">
    <button type="button" class="btn btn-secondary" data-tab="try">Try the model</button>
    <button type="button" class="btn btn-outline-secondary" data-tab="metrics">Model metrics</button>
    <button type="button" class="btn btn-outline-secondary" data-tab="explore">Explore endpoints</button>
  </nav>


    <!-- TRY THE MODEL -->
    <section id="tab-try" class="p-3">
      <div class="mb-3">
        <p class="mb-2">Start from an example, edit values, and classify.</p>
        <div class="d-flex gap-2">
          <button id="btn-load-simple" class="btn btn-sm btn-primary">Load simple example</button>
          <button id="btn-load-complete" class="btn btn-sm btn-outline-primary">Load complete example</button>
          <button id="btn-clear" class="btn btn-sm btn-outline-danger">Clear</button>
        </div>
      </div>

      <form id="form-entry" class="mb-3">
        <!-- Dynamic fields will be injected here -->
        <div id="form-fields" class="d-grid" style="grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 12px;"></div>

        <div class="mt-3 d-flex gap-2">
          <button type="submit" class="btn btn-success">Classify</button>
          <button type="button" id="btn-curl" class="btn btn-outline-secondary">Copy cURL</button>
        </div>
      </form>

      <div id="result" class="alert d-none"></div>
      <pre id="error-box" class="p-2 bg-dark text-light rounded d-none" style="white-space: pre-wrap;"></pre>
    </section>

    <!-- METRICS -->
    <section id="tab-metrics" class="p-3 d-none">
      <div class="mb-3">
        <h4 class="mb-1">Overall metrics</h4>
        <div class="mb-2 small text-muted">From <code>/api/metrics</code> and <code>/api/thresholds</code></div>
      </div>

      <div class="d-grid" style="grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 16px;">
        <div class="card p-3">
          <div class="d-flex justify-content-between mb-1">
            <span>AUC</span><b id="auc-value">—</b>
          </div>
          <div class="progress" style="height: 12px;">
            <div id="auc-bar" class="progress-bar" role="progressbar" style="width: 0%;"></div>
          </div>
        </div>

        <div class="card p-3">
          <div class="d-flex justify-content-between mb-1">
            <span>Average precision</span><b id="ap-value">—</b>
          </div>
          <div class="progress" style="height: 12px;">
            <div id="ap-bar" class="progress-bar" role="progressbar" style="width: 0%;"></div>
          </div>
        </div>

        <div class="card p-3">
          <div class="d-flex justify-content-between mb-2">
            <span>Validation size</span><b id="val-size">—</b>
          </div>
          <div class="small text-muted">Number of samples used for validation.</div>
        </div>
      </div>

      <div class="card p-3 mt-3">
        <div class="mb-2">TAU thresholds</div>
        <div class="d-flex flex-wrap gap-2">
          <span class="badge text-bg-success" id="tau-high">High: —</span>
          <span class="badge text-bg-warning" id="tau-balanced">Balanced: —</span>
          <span class="badge text-bg-danger" id="tau-low">Low: —</span>
        </div>
      </div>
    </section>

    <!-- EXPLORE -->
    <section id="tab-explore" class="p-3 d-none">
      <h4>GET</h4>
      <ul class="mb-3">
        <li><a href="{{ url_for('endpoints') }}">/api/endpoints</a></li>
        <li><a href="{{ url_for('metricsPage') }}">/api/metrics</a></li>
        <li><a href="{{ url_for('thresholdsPage') }}">/api/thresholds</a></li>
        <li><a href="{{ url_for('examplesList') }}">/api/examples/</a></li>
        <li><a href="{{ url_for('examplesPage', filename='simpleRequest.json') }}">/api/examples/simpleRequest.json</a></li>
        <li><a href="{{ url_for('examplesPage', filename='completeRequest.json') }}">/api/examples/completeRequest.json</a></li>
        <li><a href="{{ url_for('dataList') }}">/data/</a></li>
        <li><a href="{{ url_for('dataPage', filename='K2.csv') }}">/data/K2.csv</a></li>
        <li><a href="{{ url_for('dataPage', filename='KOI.csv') }}">/data/KOI.csv</a></li>
        <li><a href="{{ url_for('dataPage', filename='TOI.csv') }}">/data/TOI.csv</a></li>
      </ul>

      <h4>POST</h4>
      <ul>
        <li><code>/api/calculateDisposition</code></li>
      </ul>
    </section>
  </div>
</div>
{% endblock %}
